# üé• Terrain Camera Height Adjustment

## –û–≥–ª—è–¥

–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ—Ä–∏–≥—É—î –≤–∏—Å–æ—Ç—É –∫–∞–º–µ—Ä–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ terrain –≤ —Ç–æ—á—Ü—ñ, –Ω–∞ —è–∫—É –¥–∏–≤–∏—Ç—å—Å—è –∫–∞–º–µ—Ä–∞. –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∫–∞–º–µ—Ä–∞ –∑–∞–≤–∂–¥–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –≤–∏—Å–æ—Ç—ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ –ª–∞–Ω–¥—à–∞—Ñ—Ç—É.

## üéØ –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏:
1. **–í–∏–∑–Ω–∞—á–∞—î–º–æ —Ç–æ—á–∫—É —Ñ–æ–∫—É—Å—É** - –∫—É–¥–∏ –¥–∏–≤–∏—Ç—å—Å—è –∫–∞–º–µ—Ä–∞ (`controls.target`)
2. **–û—Ç—Ä–∏–º—É—î–º–æ –≤–∏—Å–æ—Ç—É terrain** –≤ —Ü—ñ–π —Ç–æ—á—Ü—ñ
3. **–ö–æ—Ä–∏–≥—É—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –∫–∞–º–µ—Ä–∏** - —â–æ–± –≤–æ–Ω–∞ –±—É–ª–∞ –º—ñ–Ω—ñ–º—É–º –Ω–∞ 1 –æ–¥–∏–Ω–∏—Ü—é –≤–∏—â–µ terrain
4. **–ü–ª–∞–≤–Ω–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è** - –∫–∞–º–µ—Ä–∞ –ø–ª–∞–≤–Ω–æ "–ø—ñ–¥–Ω—ñ–º–∞—î—Ç—å—Å—è" –¥–æ –Ω–æ–≤–æ—ó –≤–∏—Å–æ—Ç–∏

### –§–æ—Ä–º—É–ª–∞ –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è:
```
–ù–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è –∫–∞–º–µ—Ä–∏ = –¢–æ—á–∫–∞ —Ñ–æ–∫—É—Å—É + –ù–∞–ø—Ä—è–º–æ–∫ –∫–∞–º–µ—Ä–∏ √ó –í—ñ–¥—Å—Ç–∞–Ω—å
–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞ = –í–∏—Å–æ—Ç–∞ terrain –≤ –ø–æ–∑–∏—Ü—ñ—ó –∫–∞–º–µ—Ä–∏ + 1
```

## üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è:
```typescript
const adjustCameraHeightToTerrain = () => {
  if (!terrainHeightAdjustment) return; // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ
  
  const focusPoint = controls.target;
  const terrainHeight = terrainManager.getHeightAt(focusPoint.x, focusPoint.z);
  
  // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –Ω–æ–≤–æ—ó –ø–æ–∑–∏—Ü—ñ—ó –∫–∞–º–µ—Ä–∏
  const cameraDirection = camera.getWorldDirection(new THREE.Vector3());
  const newCameraPosition = focusPoint.clone().add(
    cameraDirection.clone().multiplyScalar(currentDistance)
  );
  
  // –ö–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –≤–∏—Å–æ—Ç–∏
  const terrainHeightAtCamera = terrainManager.getHeightAt(newCameraPosition.x, newCameraPosition.z);
  const minCameraHeight = terrainHeightAtCamera + 1;
  
  if (newCameraPosition.y < minCameraHeight) {
    newCameraPosition.y = minCameraHeight;
    camera.position.lerp(newCameraPosition, 0.1); // –ü–ª–∞–≤–Ω–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è
  }
}
```

### –ö–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è:
- **–í –∞–Ω—ñ–º–∞—Ü—ñ–π–Ω–æ–º—É —Ü–∏–∫–ª—ñ** - –∫–æ–∂–µ–Ω –∫–∞–¥—Ä
- **–ü—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ viewport** - –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫–∞–º–µ—Ä–∏
- **–ü—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞** - –ø—Ä–∏ resize

## üéÆ –ö–µ—Ä—É–≤–∞–Ω–Ω—è

### –ö–Ω–æ–ø–∫–∞ ON/OFF:
- **–ó–µ–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞** - Terrain Height Adjustment —É–≤—ñ–º–∫–Ω–µ–Ω–æ
- **–ß–µ—Ä–≤–æ–Ω–∞ –∫–Ω–æ–ø–∫–∞** - Terrain Height Adjustment –≤–∏–º–∫–Ω–µ–Ω–æ
- **–ö–ª—ñ–∫** - –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ —Å—Ç–∞–Ω–∞–º–∏

### –î–µ–±–∞–≥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:
- **Focus Point** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–æ—á–∫–∏, –Ω–∞ —è–∫—É –¥–∏–≤–∏—Ç—å—Å—è –∫–∞–º–µ—Ä–∞
- **Terrain Height at Focus** - –≤–∏—Å–æ—Ç–∞ terrain –≤ —Ç–æ—á—Ü—ñ —Ñ–æ–∫—É—Å—É
- **Camera Distance** - –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ –∫–∞–º–µ—Ä–æ—é —Ç–∞ —Ç–æ—á–∫–æ—é —Ñ–æ–∫—É—Å—É

## üìä –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
- **–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞ –Ω–∞–¥ terrain**: 1 –æ–¥–∏–Ω–∏—Ü—è
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è (lerp)**: 0.1 (10% –∑–∞ –∫–∞–¥—Ä)
- **–ß–∞—Å—Ç–æ—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**: –∫–æ–∂–µ–Ω –∫–∞–¥—Ä (60 FPS)

### –ó–º—ñ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:
```typescript
// –ó–º—ñ–Ω–∏—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –≤–∏—Å–æ—Ç—É –Ω–∞–¥ terrain
const minCameraHeight = terrainHeightAtCamera + 2; // 2 –æ–¥–∏–Ω–∏—Ü—ñ –∑–∞–º—ñ—Å—Ç—å 1

// –ó–º—ñ–Ω–∏—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è
const lerpFactor = 0.05; // –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è
const lerpFactor = 0.2;  // –®–≤–∏–¥—à–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è
```

## üéØ –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ö–∞–º–µ—Ä–∞ –Ω–∞–¥ –≥–æ—Ä–æ—é
1. –ö–∞–º–µ—Ä–∞ –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ä—à–∏–Ω—É –≥–æ—Ä–∏
2. –°–∏—Å—Ç–µ–º–∞ –≤–∏–∑–Ω–∞—á–∞—î –≤–∏—Å–æ—Ç—É terrain (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 15 –æ–¥–∏–Ω–∏—Ü—å)
3. –ö–∞–º–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥–Ω—ñ–º–∞—î—Ç—å—Å—è –¥–æ –≤–∏—Å–æ—Ç–∏ 16+ –æ–¥–∏–Ω–∏—Ü—å
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–∞–º–µ—Ä–∞ –∑–∞–≤–∂–¥–∏ –º–∞—î –≥–∞—Ä–Ω–∏–π –æ–≥–ª—è–¥ –≥–æ—Ä–∏

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ö–∞–º–µ—Ä–∞ –Ω–∞–¥ –¥–æ–ª–∏–Ω–æ—é
1. –ö–∞–º–µ—Ä–∞ –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ –¥–æ–ª–∏–Ω—É
2. –°–∏—Å—Ç–µ–º–∞ –≤–∏–∑–Ω–∞—á–∞—î –≤–∏—Å–æ—Ç—É terrain (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 2 –æ–¥–∏–Ω–∏—Ü—ñ)
3. –ö–∞–º–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–ø—É—Å–∫–∞—î—Ç—å—Å—è –¥–æ –≤–∏—Å–æ—Ç–∏ 3+ –æ–¥–∏–Ω–∏—Ü—å
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–∞–º–µ—Ä–∞ –Ω–µ "–∑–∞–≤–∏—Å–∞—î" –Ω–∞–¥ –¥–æ–ª–∏–Ω–æ—é

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ü–ª–∞–≤–Ω–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è
1. –ì—Ä–∞–≤–µ—Ü—å –ø–µ—Ä–µ–º—ñ—â—É—î –∫–∞–º–µ—Ä—É
2. –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≤–Ω–æ –∫–æ—Ä–∏–≥—É—î –≤–∏—Å–æ—Ç—É
3. –ö–∞–º–µ—Ä–∞ "–ø—ñ–¥–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è" –ø—ñ–¥ terrain
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–ª–∞–≤–Ω–∏–π, –ø—Ä–∏—Ä–æ–¥–Ω–∏–π —Ä—É—Ö –∫–∞–º–µ—Ä–∏

## üöÄ –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
1. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ** - —Ä—ñ–∑–Ω—ñ —à–≤–∏–¥–∫–æ—Å—Ç—ñ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π
2. **–ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è —Ä—É—Ö—É** - –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –≤–∏—Å–æ—Ç–∏ –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å
3. **–†—ñ–∑–Ω—ñ —Ä–µ–∂–∏–º–∏** - –∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π, –ø–æ–º—ñ—Ä–Ω–∏–π, –ø–ª–∞–≤–Ω–∏–π
4. **–ó–≤—É–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏** - –∑–≤—É–∫–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤–∏—Å–æ—Ç–∏

### –ü—Ä–∏–∫–ª–∞–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å:
```typescript
interface TerrainAdjustmentConfig {
  mode: 'aggressive' | 'moderate' | 'smooth';
  minHeightAbove: number;
  lerpSpeed: number;
  predictionDistance: number;
}

const configs = {
  aggressive: { minHeightAbove: 0.5, lerpSpeed: 0.3, predictionDistance: 5 },
  moderate: { minHeightAbove: 1.0, lerpSpeed: 0.1, predictionDistance: 3 },
  smooth: { minHeightAbove: 2.0, lerpSpeed: 0.05, predictionDistance: 1 }
};
```

## üîç –í—ñ–¥–ª–∞–¥–∫–∞

### –¢–∏–ø–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:
1. **–ö–∞–º–µ—Ä–∞ "—Å—Ç—Ä–∏–±–∞—î"** - –∑–º–µ–Ω—à—ñ—Ç—å lerpFactor
2. **–ö–∞–º–µ—Ä–∞ –Ω–µ —Ä–µ–∞–≥—É—î** - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ terrainHeightAdjustment
3. **–ü–æ–≤—ñ–ª—å–Ω–∞ —Ä–µ–∞–∫—Ü—ñ—è** - –∑–±—ñ–ª—å—à—ñ—Ç—å lerpFactor

### –õ–æ–≥–∏ –¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏:
```typescript
console.log('Terrain adjustment:', {
  focusPoint: controls.target,
  terrainHeight,
  cameraPosition: camera.position,
  newPosition: newCameraPosition
});
```

## üìù –í–∏—Å–Ω–æ–≤–æ–∫

Terrain Camera Height Adjustment –∑–∞–±–µ–∑–ø–µ—á—É—î:
- ‚úÖ **–ü—Ä–∏—Ä–æ–¥–Ω–∏–π —Ä—É—Ö –∫–∞–º–µ—Ä–∏** - –∫–∞–º–µ—Ä–∞ –∑–∞–≤–∂–¥–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –≤–∏—Å–æ—Ç—ñ
- ‚úÖ **–ü–ª–∞–≤–Ω—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏** - –±–µ–∑ —Ä—ñ–∑–∫–∏—Ö —Å—Ç—Ä–∏–±–∫—ñ–≤
- ‚úÖ **–ì–Ω—É—á–∫—ñ—Å—Ç—å** - –º–æ–∂–Ω–∞ –≤–º–∏–∫–∞—Ç–∏/–≤–∏–º–∏–∫–∞—Ç–∏
- ‚úÖ **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** - –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è 60 FPS

–¶—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–±–∏—Ç—å 3D —Å–≤—ñ—Ç –±—ñ–ª—å—à —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–º —Ç–∞ –∑—Ä—É—á–Ω–∏–º –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó!
