# üèîÔ∏è Terrain System Documentation

## –û–≥–ª—è–¥

Terrain System - —Ü–µ –Ω–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è 3D terrain, —è–∫–∞ —ñ–Ω—Ç–µ–≥—Ä—É—î—Ç—å—Å—è –∑ —ñ—Å–Ω—É—é—á–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é –±–µ–∑ –ø–æ—Ä—É—à–µ–Ω–Ω—è —ó—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏.

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### 1. **TerrainManager** (`logic/scene/terrain-manager.ts`)
**–†–æ–ª—å**: –û—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è terrain —Ç–∞ –≤–∏—Å–æ—Ç–∞–º–∏

**–ö–ª—é—á–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó**:
- `getHeightAt(x, z)` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏—Å–æ—Ç–∏ –≤ –∑–∞–¥–∞–Ω—ñ–π —Ç–æ—á—Ü—ñ
- `canPlaceObjectAt(position, height)` - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞
- `snapToTerrain(position, height)` - –ø—Ä–∏–º—É—Å–æ–≤–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –Ω–∞ terrain
- `getNormalAt(x, z)` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—ñ terrain –¥–ª—è –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è**:
```typescript
interface TerrainConfig {
    width: number;        // –®–∏—Ä–∏–Ω–∞ terrain
    height: number;       // –í–∏—Å–æ—Ç–∞ terrain  
    resolution: number;   // –†–æ–∑–º—ñ—Ä –∫–ª—ñ—Ç–∏–Ω–∫–∏
    maxHeight: number;    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞
    minHeight: number;    // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞
}
```

### 2. **TerrainRenderer** (`src/components/renderers/TerrainRenderer.ts`)
**–†–æ–ª—å**: –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è terrain –≤ Three.js

**–ö–ª—é—á–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó**:
- `renderTerrain()` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è 3D –º–µ—à–∞ –¥–ª—è terrain
- `updateTerrain()` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤–∏—Å–æ—Ç
- `removeTerrain()` - –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑—ñ —Å—Ü–µ–Ω–∏

### 3. **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ SceneLogic**
**–†–æ–ª—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è terrain constraint

**–ù–æ–≤—ñ –º–µ—Ç–æ–¥–∏**:
- `pushObjectWithTerrainConstraint()` - –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è–º –Ω–∞ terrain
- `moveObjectWithTerrainConstraint()` - –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∑ terrain constraint
- `validateTerrainConstraint()` - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ constraint

## üéØ Terrain Constraint System

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏:
1. **–û–±'—î–∫—Ç–∏ –∑ —Ç–µ–≥–æ–º `on-ground`** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–º—ñ—â—É—é—Ç—å—Å—è –Ω–∞ terrain
2. **–û–±'—î–∫—Ç–∏ –±–µ–∑ —Ç–µ–≥—É** –º–æ–∂—É—Ç—å –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏—Å—è –≤ –±—É–¥—å-—è–∫—ñ–π –ø–æ–∑–∏—Ü—ñ—ó
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø—Ä–∏ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—ñ

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
```typescript
// –û–±'—î–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ terrain
const groundObject: TSceneObject = {
    id: 'ground_cube',
    type: 'cube',
    coordinates: { x: 10, y: 0, z: 10 }, // Y –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
    scale: { x: 1, y: 1, z: 1 },
    rotation: { x: 0, y: 0, z: 0 },
    data: { color: 0x00ff00 },
    tags: ['on-ground'] // –ö–ª—é—á–æ–≤–∏–π —Ç–µ–≥!
};

// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ terrain constraint
scene.pushObjectWithTerrainConstraint(groundObject);
```

## üîß –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è Terrain

### –ü–æ—Ç–æ—á–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º:
- **–ü—Ä–æ—Å—Ç–∏–π —à—É–º** –Ω–∞ –æ—Å–Ω–æ–≤—ñ sin/cos —Ñ—É–Ω–∫—Ü—ñ–π
- **–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–ª—è Perlin noise** - –∑–∞–º—ñ–Ω—ñ—Ç—å `simpleNoise()` –Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π Perlin noise
- **–ù–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω–∞ —Ä–æ–∑–¥—ñ–ª—å–Ω—ñ—Å—Ç—å** —á–µ—Ä–µ–∑ `resolution`

### –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
```typescript
// –ó–∞–º—ñ–Ω—ñ—Ç—å simpleNoise –Ω–∞ Perlin noise
private perlinNoise(x: number, z: number): number {
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É Perlin noise
    return perlin.get(x * 0.1, z * 0.1);
}
```

## üìä –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
- **Grid-based —Å–∏—Å—Ç–µ–º–∞** - —Ç–∞–∫–∞ –∂ —è–∫ —É SceneLogic
- **–ö–µ—à—É–≤–∞–Ω–Ω—è –≤–∏—Å–æ—Ç** - —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- **LOD —Å–∏—Å—Ç–µ–º–∞** - –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö terrain

### –ú–µ—Ç—Ä–∏–∫–∏:
- **–†–æ–∑–º—ñ—Ä –∫–ª—ñ—Ç–∏–Ω–∫–∏**: 25x25 –æ–¥–∏–Ω–∏—Ü—å (—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ grid —Å–∏—Å—Ç–µ–º–æ—é)
- **–†–æ–∑–º—ñ—Ä terrain**: 2000x2000 –æ–¥–∏–Ω–∏—Ü—å
- **–î—ñ–∞–ø–∞–∑–æ–Ω –≤–∏—Å–æ—Ç**: -10 –¥–æ +100 –æ–¥–∏–Ω–∏—Ü—å

## üöÄ –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
1. **–¢–µ–∫—Å—Ç—É—Ä–∏** - —Ä—ñ–∑–Ω—ñ —Ç–µ–∫—Å—Ç—É—Ä–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≤–∏—Å–æ—Ç
2. **LOD —Å–∏—Å—Ç–µ–º–∞** - —Ä—ñ–∑–Ω–∞ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤—ñ–¥—Å—Ç–∞–Ω—ñ
3. **–î–∏–Ω–∞–º—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏** - —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è, –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ
4. **–ë—ñ–æ–º—ñ** - —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ terrain (–ª—ñ—Å, –≥–æ—Ä–∞, —Ä—ñ–≤–Ω–∏–Ω–∞)

### –ü—Ä–∏–∫–ª–∞–¥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –±—ñ–æ–º—ñ–≤:
```typescript
interface Biome {
    name: string;
    heightRange: [number, number];
    texture: string;
    objects: string[];
}

const biomes: Biome[] = [
    { name: 'forest', heightRange: [0, 20], texture: 'grass', objects: ['tree'] },
    { name: 'mountain', heightRange: [20, 100], texture: 'rock', objects: ['boulder'] }
];
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏:
- `testTerrainSystem()` - —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
- `generateTestHeightMap()` - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ terrain

### –†—É—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å terrain —Ç–µ—Å—Ç—ñ–≤
3. –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ –∑–µ–ª–µ–Ω–∏–π terrain –º–µ—à
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –∫—É–±–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–º—ñ—â—É—é—Ç—å—Å—è –Ω–∞ terrain

## üîó –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —ñ—Å–Ω—É—é—á–æ—é —Å–∏—Å—Ç–µ–º–æ—é

### –ë–µ–∑ –∑–º—ñ–Ω:
- ‚úÖ SceneLogic API
- ‚úÖ RendererManager
- ‚úÖ BaseRenderer
- ‚úÖ MapLogic –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞

### –ù–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
- üÜï Terrain constraint –¥–ª—è `on-ground` –æ–±'—î–∫—Ç—ñ–≤
- üÜï –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –Ω–∞ terrain
- üÜï –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è terrain
- üÜï –°–∏—Å—Ç–µ–º–∞ –≤–∏—Å–æ—Ç —Ç–∞ –Ω–æ—Ä–º–∞–ª–µ–π

## üìù –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è terrain:
```typescript
const terrainConfig: TerrainConfig = {
    width: 2000,
    height: 2000,
    resolution: 25,
    maxHeight: 100,
    minHeight: -10
};

const terrainManager = new TerrainManager(terrainConfig);
```

### –†–æ–∑–º—ñ—â–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –Ω–∞ terrain:
```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
scene.pushObjectWithTerrainConstraint(object);

// –†—É—á–Ω–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
const terrainHeight = terrainManager.getHeightAt(x, z);
object.coordinates.y = terrainHeight;
```

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ terrain:
```typescript
const height = terrainManager.getHeightAt(x, z);
const normal = terrainManager.getNormalAt(x, z);
const canPlace = terrainManager.canPlaceObjectAt(position, height);
```

–¶—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–ª–∞–≤–Ω—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑ —ñ—Å–Ω—É—é—á–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î –Ω–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è 3D —Å–≤—ñ—Ç—É!
